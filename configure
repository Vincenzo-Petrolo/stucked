#!/bin/sh
# Minimal ./configure for stucked
# Usage: ./configure [--prefix=/usr/local] [CC=...] [CFLAGS=...]
set -e

PREFIX="/usr/local"
VERSION="1.0.0"

# Parse --prefix
for arg in "$@"; do
  case "$arg" in
    --prefix=*)
      PREFIX="${arg#*=}"
      ;;
  esac
done

# Allow environment overrides
: "${CC:=cc}"
: "${CFLAGS:=-O2}"

# Create Makefile from template
sed   -e "s|@CC@|$CC|g"   -e "s|@CFLAGS@|$CFLAGS|g"   -e "s|@PREFIX@|$PREFIX|g"   -e "s|@VERSION@|$VERSION|g"   Makefile.in > Makefile

echo "Configuration summary:"
echo "  CC      : $CC"
echo "  CFLAGS  : $CFLAGS"
echo "  prefix  : $PREFIX"
echo
echo "Now run:  make"
